<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>English Speaking Practice Tool</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .tab {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            transition: all 0.3s;
        }

        .tab:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .tab.active {
            background: white;
            color: #667eea;
            font-weight: 600;
        }

        .content {
            background: white;
            border-radius: 16px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            min-height: 500px;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        h2 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 1.8em;
        }

        h3 {
            color: #764ba2;
            margin: 20px 0 10px 0;
            font-size: 1.3em;
        }

        .practice-card {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            border-left: 4px solid #667eea;
        }

        .practice-card h4 {
            color: #333;
            margin-bottom: 10px;
            font-size: 1.2em;
        }

        .timer-container {
            background: #fff;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            margin: 20px 0;
        }

        .timer {
            font-size: 3em;
            font-weight: bold;
            color: #667eea;
            margin: 20px 0;
            font-family: 'Courier New', monospace;
        }

        .timer-controls {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            transition: all 0.3s;
            font-weight: 500;
        }

        .btn:hover {
            background: #764ba2;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-secondary {
            background: #48bb78;
        }

        .btn-secondary:hover {
            background: #38a169;
        }

        .btn-danger {
            background: #f56565;
        }

        .btn-danger:hover {
            background: #e53e3e;
        }

        .topic-selector {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .topic-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            transition: all 0.3s;
        }

        .topic-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }

        .recording-indicator {
            display: none;
            align-items: center;
            justify-content: center;
            gap: 10px;
            padding: 15px;
            background: #fed7d7;
            border-radius: 8px;
            margin: 15px 0;
        }

        .recording-indicator.active {
            display: flex;
        }

        .recording-dot {
            width: 12px;
            height: 12px;
            background: #f56565;
            border-radius: 50%;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }

        .week-plan {
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            padding: 20px;
            margin: 15px 0;
        }

        .week-plan h4 {
            color: #667eea;
            margin-bottom: 15px;
        }

        .daily-task {
            background: #f7fafc;
            padding: 12px;
            margin: 8px 0;
            border-radius: 6px;
            border-left: 3px solid #48bb78;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px;
            margin: 5px 0;
        }

        .checkbox-item input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .progress-bar {
            width: 100%;
            height: 30px;
            background: #e2e8f0;
            border-radius: 15px;
            overflow: hidden;
            margin: 20px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #48bb78 0%, #38a169 100%);
            transition: width 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .phrase-bank {
            background: #edf2f7;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
        }

        .phrase-item {
            padding: 10px;
            margin: 5px 0;
            background: white;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .phrase-item:hover {
            background: #667eea;
            color: white;
            transform: translateX(5px);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
        }

        .stat-number {
            font-size: 2.5em;
            font-weight: bold;
            margin: 10px 0;
        }

        .stat-label {
            opacity: 0.9;
            font-size: 0.9em;
        }

        .resource-link {
            display: block;
            padding: 12px;
            margin: 8px 0;
            background: #f7fafc;
            border-radius: 6px;
            color: #667eea;
            text-decoration: none;
            transition: all 0.2s;
        }

        .resource-link:hover {
            background: #667eea;
            color: white;
            transform: translateX(5px);
        }

        /* AI Scoring Modal */
        .modal-overlay {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.6);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(4px);
        }

        .modal-overlay.open {
            display: flex;
        }

        .modal {
            background: white;
            border-radius: 20px;
            padding: 36px;
            max-width: 620px;
            width: 95%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 30px 80px rgba(0,0,0,0.35);
            animation: modalPop 0.3s cubic-bezier(.34,1.56,.64,1);
        }

        @keyframes modalPop {
            from { opacity: 0; transform: scale(0.88) translateY(20px); }
            to   { opacity: 1; transform: scale(1) translateY(0); }
        }

        .modal h3 { font-size: 1.5em; color: #1a1a2e; margin-bottom: 6px; }

        .modal-subtitle { color: #666; font-size: 0.95em; margin-bottom: 24px; }

        .modal textarea {
            width: 100%;
            padding: 14px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-size: 0.95em;
            font-family: inherit;
            resize: vertical;
            min-height: 130px;
            transition: border-color 0.2s;
            box-sizing: border-box;
        }

        .modal textarea:focus { outline: none; border-color: #667eea; }

        .modal-field-label {
            font-weight: 600;
            color: #333;
            margin: 18px 0 8px 0;
            font-size: 0.9em;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .topic-chips { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 6px; }

        .topic-chip {
            background: #eef2ff;
            color: #667eea;
            border: 2px solid #c7d2fe;
            border-radius: 20px;
            padding: 6px 14px;
            font-size: 0.85em;
            cursor: pointer;
            transition: all 0.2s;
        }

        .topic-chip:hover, .topic-chip.selected { background: #667eea; color: white; border-color: #667eea; }

        .modal-actions { display: flex; gap: 12px; margin-top: 24px; justify-content: flex-end; }

        /* Score Result Card */
        .score-result { display: none; margin-top: 20px; border-radius: 14px; overflow: hidden; border: 2px solid #e2e8f0; }
        .score-result.visible { display: block; }

        .score-header {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 20px 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .score-total { font-size: 3em; font-weight: 800; line-height: 1; }
        .score-total-label { font-size: 0.85em; opacity: 0.85; margin-top: 4px; }
        .score-grade { font-size: 1.8em; font-weight: 700; text-align: right; }

        .score-dimensions { padding: 20px 24px; display: grid; grid-template-columns: 1fr 1fr; gap: 14px; }

        .score-dim { background: #f8fafc; border-radius: 10px; padding: 12px 14px; }

        .score-dim-name {
            font-size: 0.8em;
            font-weight: 600;
            color: #888;
            text-transform: uppercase;
            letter-spacing: 0.04em;
            margin-bottom: 6px;
        }

        .score-dim-bar-wrap { background: #e2e8f0; border-radius: 4px; height: 8px; margin-bottom: 4px; overflow: hidden; }

        .score-dim-bar { height: 100%; border-radius: 4px; transition: width 0.8s cubic-bezier(.4,0,.2,1); }

        .score-dim-num { font-size: 0.85em; font-weight: 700; color: #444; }

        .score-feedback { padding: 0 24px 20px; }
        .score-feedback h4 { color: #333; margin-bottom: 10px; font-size: 1em; }

        .feedback-item {
            display: flex;
            gap: 10px;
            padding: 8px 0;
            border-bottom: 1px solid #f0f0f0;
            font-size: 0.9em;
            color: #555;
            line-height: 1.5;
        }

        .feedback-icon { font-size: 1.1em; flex-shrink: 0; }

        .ai-loading { text-align: center; padding: 30px; color: #667eea; }

        .ai-loading-dots span {
            display: inline-block;
            width: 10px; height: 10px;
            background: #667eea;
            border-radius: 50%;
            margin: 0 4px;
            animation: bounce 1.2s infinite;
        }

        .ai-loading-dots span:nth-child(2) { animation-delay: 0.2s; }
        .ai-loading-dots span:nth-child(3) { animation-delay: 0.4s; }

        @keyframes bounce {
            0%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-10px); }
        }

        /* Calendar score colour intensity */
        .calendar-day.score-1 { background: #c6f6d5; border-color: #9ae6b4; color: #22543d; }
        .calendar-day.score-2 { background: #9ae6b4; border-color: #68d391; color: #22543d; }
        .calendar-day.score-3 { background: #68d391; border-color: #48bb78; color: #1a4731; }
        .calendar-day.score-4 { background: #48bb78; border-color: #38a169; color: white; }
        .calendar-day.score-5 { background: #38a169; border-color: #276749; color: white; }

        /* LeetCode-style Calendar */
        .calendar-container {
            background: white;
            padding: 20px;
            border-radius: 12px;
            margin: 20px 0;
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .calendar-nav {
            display: flex;
            gap: 10px;
        }

        .calendar-nav button {
            background: #667eea;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9em;
        }

        .calendar-nav button:hover {
            background: #764ba2;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 8px;
            margin-bottom: 20px;
        }

        .calendar-day-label {
            text-align: center;
            font-size: 0.8em;
            font-weight: 600;
            color: #666;
            padding: 8px;
        }

        .calendar-day {
            aspect-ratio: 1;
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
            border: 2px solid #e2e8f0;
            background: #f7fafc;
            position: relative;
        }

        .calendar-day:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            z-index: 10;
        }

        .calendar-day.other-month {
            opacity: 0.3;
            pointer-events: none;
        }

        .calendar-day.today {
            border-color: #667eea;
            background: #eef2ff;
            font-weight: bold;
        }

        .calendar-day.practiced {
            background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
            color: white;
            border-color: #38a169;
        }

        .calendar-day.practiced:hover {
            background: linear-gradient(135deg, #38a169 0%, #2f855a 100%);
        }

        .calendar-day-number {
            font-size: 0.9em;
            font-weight: 600;
        }

        .calendar-day-minutes {
            font-size: 0.7em;
            opacity: 0.9;
            margin-top: 2px;
        }

        .calendar-legend {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9em;
        }

        .legend-box {
            width: 20px;
            height: 20px;
            border-radius: 4px;
            border: 2px solid #e2e8f0;
        }

        .legend-box.practiced {
            background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
            border-color: #38a169;
        }

        .legend-box.today {
            border-color: #667eea;
            background: #eef2ff;
        }

        .streak-info {
            display: flex;
            justify-content: space-around;
            margin: 20px 0;
            padding: 20px;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            border-radius: 12px;
        }

        .streak-item {
            text-align: center;
        }

        .streak-number {
            font-size: 2em;
            font-weight: bold;
            color: #667eea;
        }

        .streak-label {
            font-size: 0.9em;
            color: #666;
            margin-top: 5px;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.8em;
            }
            
            .tabs {
                flex-direction: column;
            }
            
            .content {
                padding: 20px;
            }

            .topic-selector {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üó£Ô∏è English Speaking Practice Tool</h1>
            <p>Build workplace fluency with daily practice & proven techniques</p>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="switchTab('daily')">Daily Routine</button>
            <button class="tab" onclick="switchTab('techniques')">Speaking Techniques</button>
            <button class="tab" onclick="switchTab('fourweek')">4-Week Plan</button>
            <button class="tab" onclick="switchTab('phrases')">Phrase Bank</button>
            <button class="tab" onclick="switchTab('progress')">Track Progress</button>
            <button class="tab" onclick="switchTab('resources')">Apps & Resources</button>
        </div>

        <div class="content">
            <!-- Daily Routine Tab -->
            <div id="daily" class="tab-content active">
                <h2>Daily Speaking Routine (15-30 mins)</h2>
                
                <div class="practice-card">
                    <h4>üåÖ Warm-up: Self-Talk (5 mins)</h4>
                    <p>Talk about your day, plans, or thoughts out loud. Record yourself 2-3 times per week.</p>
                    <div class="recording-indicator" id="warmup-recording">
                        <div class="recording-dot"></div>
                        <span>Recording in progress...</span>
                    </div>
                    <div class="timer-controls" style="margin-top: 15px;">
                        <button class="btn" onclick="startPractice('warmup', 5)">Start 5-min Warmup</button>
                        <button class="btn-secondary btn" id="record-warmup-btn" onclick="toggleRecording('warmup')">üéôÔ∏è Record</button>
                        <button class="btn btn" id="play-warmup-btn" onclick="playRecording('warmup')" style="display: none;">‚ñ∂Ô∏è Play Recording</button>
                        <button class="btn-danger btn" id="delete-warmup-btn" onclick="deleteRecording('warmup')" style="display: none;">üóëÔ∏è Delete</button>
                    </div>
                    <div id="warmup-recordings-list" style="margin-top: 15px;"></div>
                </div>

                <div class="practice-card">
                    <h4>üí° Topic Speaking (10 mins)</h4>
                    <p>Pick a topic and talk non-stop for 2-3 minutes. Repeat 2-3 rounds.</p>
                    <div class="topic-selector">
                        <button class="topic-btn" onclick="setTopic('Work Project')">Work Project</button>
                        <button class="topic-btn" onclick="setTopic('Data Analysis')">Data Analysis</button>
                        <button class="topic-btn" onclick="setTopic('Team Meeting')">Team Meeting</button>
                        <button class="topic-btn" onclick="setTopic('Travel Plans')">Travel Plans</button>
                        <button class="topic-btn" onclick="setTopic('Technology Trends')">Technology Trends</button>
                        <button class="topic-btn" onclick="setTopic('Hobbies')">Hobbies</button>
                    </div>
                    <div id="selected-topic" style="margin: 15px 0; padding: 15px; background: #edf2f7; border-radius: 8px; display: none;">
                        <strong>Current Topic:</strong> <span id="topic-name"></span>
                    </div>
                    <div class="timer-controls">
                        <button class="btn" onclick="startPractice('topic', 4)">4 minutes</button>
                        <button class="btn" onclick="startPractice('topic', 3)">3 minutes</button>
                        <button class="btn" onclick="startPractice('topic', 2)">2 minutes</button>
                    </div>
                </div>

                <div class="practice-card">
                    <h4>üí¨ Conversation Practice (5-15 mins)</h4>
                    <p>Focus on one workplace situation: meetings, presentations, or small talk.</p>
                    <div class="timer-controls">
                        <button class="btn" onclick="startPractice('conversation', 10)">Start 10-min Practice</button>
                        <button class="btn btn-secondary" onclick="openScoreModal()">‚ú® Get AI Score</button>
                    </div>
                </div>

                <div class="timer-container">
                    <h3 id="practice-title">Select a practice to begin</h3>
                    <div class="timer" id="timer">00:00</div>
                    <div class="timer-controls">
                        <button class="btn-secondary btn" id="start-btn" onclick="startTimer()" disabled>Start</button>
                        <button class="btn-danger btn" id="stop-btn" onclick="stopTimer()" disabled>Stop</button>
                        <button class="btn btn" id="reset-btn" onclick="resetTimer()">Reset</button>
                    </div>
                </div>
            </div>

            <!-- Speaking Techniques Tab -->
            <div id="techniques" class="tab-content">
                <h2>High-Impact Speaking Techniques</h2>

                <div class="practice-card">
                    <h4>üéØ Shadowing (Imitation)</h4>
                    <p>Choose a video or podcast, play one sentence, pause, and copy exactly their words, rhythm, and intonation.</p>
                    <h4 style="margin-top: 15px; font-size: 1em;">Steps:</h4>
                    <ol style="margin-left: 20px; line-height: 1.8;">
                        <li>Find a YouTube video or podcast (business/tech topics work well)</li>
                        <li>Play 1 sentence and pause</li>
                        <li>Repeat the sentence exactly, matching rhythm and intonation</li>
                        <li>Continue for 10-15 minutes daily</li>
                    </ol>
                    <div class="timer-controls" style="margin-top: 15px;">
                        <button class="btn" onclick="startPractice('shadowing', 10)">Start 10-min Shadowing</button>
                        <button class="btn" onclick="startPractice('shadowing', 15)">Start 15-min Shadowing</button>
                    </div>
                </div>

                <div class="practice-card">
                    <h4>‚ö° 4/3/2 Technique</h4>
                    <p>Tell the same story three times with decreasing time limits. This builds speed and fluency.</p>
                    <div class="checkbox-item">
                        <input type="checkbox" id="round1">
                        <label for="round1">Round 1: Tell your story in 4 minutes</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="round2">
                        <label for="round2">Round 2: Same story in 3 minutes</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="round3">
                        <label for="round3">Round 3: Same story in 2 minutes</label>
                    </div>
                </div>

                <div class="practice-card">
                    <h4>üß© Chunking Practice</h4>
                    <p>Learn and practice full phrases instead of individual words. This helps you speak more smoothly.</p>
                    <h4 style="margin-top: 15px; font-size: 1em;">Common Workplace Chunks:</h4>
                    <div class="phrase-bank">
                        <div class="phrase-item">"On the other hand..."</div>
                        <div class="phrase-item">"From a data perspective..."</div>
                        <div class="phrase-item">"Let me think for a second..."</div>
                        <div class="phrase-item">"What I'm seeing in the numbers is..."</div>
                        <div class="phrase-item">"The trend here shows..."</div>
                        <div class="phrase-item">"We can see a spike in..."</div>
                        <div class="phrase-item">"This suggests that..."</div>
                    </div>
                    <button class="btn" onclick="startPractice('chunking', 10)">Practice for 10 mins</button>
                </div>
            </div>

            <!-- 4-Week Plan Tab -->
            <div id="fourweek" class="tab-content">
                <h2>4-Week Workplace Fluency Plan</h2>
                <p style="margin-bottom: 20px;">Target: Upper-intermediate (B1-B2) learners focusing on workplace English</p>

                <div class="week-plan">
                    <h4>Week 1: Everyday Work English</h4>
                    <p><strong>Goal:</strong> Talk about your day and tasks without long pauses</p>
                    <div class="daily-task">
                        <strong>Daily (30 min):</strong>
                        <div class="checkbox-item">
                            <input type="checkbox" id="w1d1">
                            <label for="w1d1">10 min: Self-talk about workday (record 2x/week)</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="w1d2">
                            <label for="w1d2">10 min: Shadow office/productivity video</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="w1d3">
                            <label for="w1d3">10 min: Read tech article, summarize aloud</label>
                        </div>
                    </div>
                    <div class="daily-task" style="border-left-color: #667eea;">
                        <strong>2 days/week (30-45 min):</strong>
                        <div class="checkbox-item">
                            <input type="checkbox" id="w1t1">
                            <label for="w1t1">AI tutor session: Small talk and "What do you do?"</label>
                        </div>
                    </div>
                </div>

                <div class="week-plan">
                    <h4>Week 2: Meetings and Stand-ups</h4>
                    <p><strong>Goal:</strong> Speak smoothly in meetings and status updates</p>
                    <div class="daily-task">
                        <strong>Daily (30-40 min):</strong>
                        <div class="checkbox-item">
                            <input type="checkbox" id="w2d1">
                            <label for="w2d1">10 min: Practice update templates</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="w2d2">
                            <label for="w2d2">10-15 min: Timed 4/3/2 speaking on one task</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="w2d3">
                            <label for="w2d3">10-15 min: Listen to meeting clips, note phrases</label>
                        </div>
                    </div>
                    <div class="daily-task" style="border-left-color: #667eea;">
                        <strong>2 days/week:</strong>
                        <div class="checkbox-item">
                            <input type="checkbox" id="w2t1">
                            <label for="w2t1">Role-play stand-up meeting with AI/tutor</label>
                        </div>
                    </div>
                </div>

                <div class="week-plan">
                    <h4>Week 3: Presentations and Data</h4>
                    <p><strong>Goal:</strong> Explain data, charts, and decisions clearly</p>
                    <div class="daily-task">
                        <strong>Daily (30-40 min):</strong>
                        <div class="checkbox-item">
                            <input type="checkbox" id="w3d1">
                            <label for="w3d1">10-15 min: Explain real chart to non-technical person</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="w3d2">
                            <label for="w3d2">10 min: Drill data presentation phrases</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="w3d3">
                            <label for="w3d3">10-15 min: Record 3-min mini-presentation</label>
                        </div>
                    </div>
                    <div class="daily-task" style="border-left-color: #667eea;">
                        <strong>2 days/week:</strong>
                        <div class="checkbox-item">
                            <input type="checkbox" id="w3t1">
                            <label for="w3t1">Present project to tutor with Q&A</label>
                        </div>
                    </div>
                </div>

                <div class="week-plan">
                    <h4>Week 4: Difficult Situations & Speed</h4>
                    <p><strong>Goal:</strong> Respond faster and sound confident in challenges</p>
                    <div class="daily-task">
                        <strong>Daily (30-40 min):</strong>
                        <div class="checkbox-item">
                            <input type="checkbox" id="w4d1">
                            <label for="w4d1">10-15 min: Role-play difficult moments</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="w4d2">
                            <label for="w4d2">10-15 min: Fast Q&A about work (1-2 sentence answers)</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="w4d3">
                            <label for="w4d3">10 min: Review and practice vocabulary notebook</label>
                        </div>
                    </div>
                    <div class="daily-task" style="border-left-color: #667eea;">
                        <strong>End of week:</strong>
                        <div class="checkbox-item">
                            <input type="checkbox" id="w4t1">
                            <label for="w4t1">Record 5-min talk, compare with Week 1</label>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Phrase Bank Tab -->
            <div id="phrases" class="tab-content">
                <h2>Workplace Phrase Bank</h2>
                <p style="margin-bottom: 20px;">Click any phrase to practice saying it aloud</p>

                <h3>Buffer Phrases (to avoid silence)</h3>
                <div class="phrase-bank">
                    <div class="phrase-item" onclick="speakPhrase(this)">"Let me think for a second..."</div>
                    <div class="phrase-item" onclick="speakPhrase(this)">"From a data point of view..."</div>
                    <div class="phrase-item" onclick="speakPhrase(this)">"What I'm seeing in the numbers is..."</div>
                    <div class="phrase-item" onclick="speakPhrase(this)">"That's a good question. Let me consider..."</div>
                    <div class="phrase-item" onclick="speakPhrase(this)">"If I understand correctly..."</div>
                </div>

                <h3>Meeting Updates</h3>
                <div class="phrase-bank">
                    <div class="phrase-item" onclick="speakPhrase(this)">"Yesterday I worked on... Today I'm focusing on..."</div>
                    <div class="phrase-item" onclick="speakPhrase(this)">"I'm currently blocked by..."</div>
                    <div class="phrase-item" onclick="speakPhrase(this)">"The main challenge I'm facing is..."</div>
                    <div class="phrase-item" onclick="speakPhrase(this)">"I'll have this completed by..."</div>
                    <div class="phrase-item" onclick="speakPhrase(this)">"I need support with..."</div>
                </div>

                <h3>Data Presentations</h3>
                <div class="phrase-bank">
                    <div class="phrase-item" onclick="speakPhrase(this)">"The trend here shows..."</div>
                    <div class="phrase-item" onclick="speakPhrase(this)">"We can see a spike in..."</div>
                    <div class="phrase-item" onclick="speakPhrase(this)">"This suggests that..."</div>
                    <div class="phrase-item" onclick="speakPhrase(this)">"Based on the data..."</div>
                    <div class="phrase-item" onclick="speakPhrase(this)">"The key insight here is..."</div>
                    <div class="phrase-item" onclick="speakPhrase(this)">"If we look at the numbers..."</div>
                </div>

                <h3>Agreeing & Disagreeing</h3>
                <div class="phrase-bank">
                    <div class="phrase-item" onclick="speakPhrase(this)">"I see your point, and..."</div>
                    <div class="phrase-item" onclick="speakPhrase(this)">"That makes sense. I'd also add..."</div>
                    <div class="phrase-item" onclick="speakPhrase(this)">"I understand, but have we considered..."</div>
                    <div class="phrase-item" onclick="speakPhrase(this)">"I have a slightly different perspective..."</div>
                    <div class="phrase-item" onclick="speakPhrase(this)">"That's a valid concern. Perhaps we could..."</div>
                </div>

                <h3>Clarifying & Questions</h3>
                <div class="phrase-bank">
                    <div class="phrase-item" onclick="speakPhrase(this)">"Could you clarify what you mean by..."</div>
                    <div class="phrase-item" onclick="speakPhrase(this)">"Just to make sure I understand..."</div>
                    <div class="phrase-item" onclick="speakPhrase(this)">"Can you walk me through..."</div>
                    <div class="phrase-item" onclick="speakPhrase(this)">"What's the timeline for..."</div>
                    <div class="phrase-item" onclick="speakPhrase(this)">"How does this align with..."</div>
                </div>
            </div>

            <!-- Progress Tab -->
            <div id="progress" class="tab-content">
                <h2>Track Your Progress</h2>
                
                <div style="text-align: right; margin-bottom: 15px; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 10px;">
                    <div style="display: flex; align-items: center; gap: 10px; flex-wrap: wrap;">
                        <span style="font-size:0.9em; color:#666; font-weight:600;">üîë Gemini API Key:</span>
                        <input type="password" id="api-key-input" placeholder="AIza..." 
                            style="padding: 8px 12px; border: 2px solid #e2e8f0; border-radius: 8px; font-size: 0.85em; width: 220px;"
                            oninput="saveApiKey(this.value)">
                        <span id="api-key-status" style="font-size:0.8em; color:#48bb78; display:none;">‚úì Saved</span>
                    </div>
                    <div style="display: flex; gap: 10px;">
                        <button class="btn btn-secondary" onclick="openScoreModal()">‚ú® Get AI Score</button>
                        <button class="btn-danger btn" id="reset-all-btn">üîÑ Reset All Progress</button>
                    </div>
                </div>

                <!-- Practice Calendar -->
                <div class="calendar-container">
                    <h3 style="margin-bottom: 15px;">üìÖ Practice Calendar</h3>
                    
                    <div class="streak-info">
                        <div class="streak-item">
                            <div class="streak-number" id="current-streak">0</div>
                            <div class="streak-label">üî• Current Streak</div>
                        </div>
                        <div class="streak-item">
                            <div class="streak-number" id="longest-streak">0</div>
                            <div class="streak-label">üèÜ Longest Streak</div>
                        </div>
                        <div class="streak-item">
                            <div class="streak-number" id="total-days">0</div>
                            <div class="streak-label">üìä Total Days</div>
                        </div>
                    </div>

                    <div class="calendar-header">
                        <h4 id="calendar-month-year" style="color: #667eea; margin: 0;"></h4>
                        <div class="calendar-nav">
                            <button onclick="changeMonth(-1)">‚Üê Prev</button>
                            <button onclick="changeMonth(0)">Today</button>
                            <button onclick="changeMonth(1)">Next ‚Üí</button>
                        </div>
                    </div>

                    <div class="calendar-grid" id="calendar-grid"></div>

                    <div class="calendar-legend">
                        <div class="legend-item">
                            <div class="legend-box"></div>
                            <span>No practice</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-box" style="background:#c6f6d5; border-color:#9ae6b4;"></div>
                            <span>Low score</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-box" style="background:#68d391; border-color:#48bb78;"></div>
                            <span>Mid score</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-box" style="background:#38a169; border-color:#276749;"></div>
                            <span>High score</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-box today"></div>
                            <span>Today</span>
                        </div>
                    </div>
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-label">Days Practiced</div>
                        <div class="stat-number" id="days-practiced">0</div>
                        <button class="btn" style="margin-top: 10px; background: rgba(255,255,255,0.2);" onclick="incrementStat('days-practiced')">Log Today</button>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Total Minutes</div>
                        <div class="stat-number" id="total-minutes">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Recordings Made</div>
                        <div class="stat-number" id="recordings">0</div>
                        <button class="btn" style="margin-top: 10px; background: rgba(255,255,255,0.2);" onclick="incrementStat('recordings')">Add Recording</button>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">New Phrases Learned</div>
                        <div class="stat-number" id="phrases-learned">0</div>
                        <button class="btn" style="margin-top: 10px; background: rgba(255,255,255,0.2);" onclick="incrementStat('phrases-learned')">Add 5 Phrases</button>
                    </div>
                </div>

                <h3>Weekly Progress</h3>
                <div class="progress-bar">
                    <div class="progress-fill" id="weekly-progress" style="width: 0%">0%</div>
                </div>
                <p style="text-align: center; margin-top: 10px;">Complete daily tasks to increase your progress</p>

                <h3 style="margin-top: 30px;">Measure Your Improvement</h3>
                <div class="practice-card">
                    <h4>Track Hesitations</h4>
                    <p>Count long pauses in recordings. You should see fewer pauses over weeks.</p>
                    <div style="margin-top: 10px;">
                        <label>Pauses in latest recording: </label>
                        <input type="number" id="pause-count" min="0" style="padding: 8px; border-radius: 4px; border: 1px solid #ccc; margin-left: 10px;">
                        <button class="btn" style="margin-left: 10px;" onclick="savePauseCount()">Save</button>
                    </div>
                    <div id="pause-history" style="margin-top: 15px;"></div>
                </div>

                <div class="practice-card">
                    <h4>Real-life Practice</h4>
                    <p>Check off when you speak in actual work situations:</p>
                    <div class="checkbox-item">
                        <input type="checkbox" onclick="updateProgress()">
                        <label>Asked a question in a meeting</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" onclick="updateProgress()">
                        <label>Gave a status update</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" onclick="updateProgress()">
                        <label>Explained data or a chart</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" onclick="updateProgress()">
                        <label>Had small talk with colleagues</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" onclick="updateProgress()">
                        <label>Disagreed politely in discussion</label>
                    </div>
                </div>
            </div>

            <!-- Resources Tab -->
            <div id="resources" class="tab-content">
                <h2>Recommended Apps & Resources</h2>

                <h3>Live Conversation Apps</h3>
                <div class="practice-card">
                    <h4>EngVarta</h4>
                    <p>Live calls with English experts for real-life practice and real-time corrections. Good for professionals.</p>
                    <a href="https://engvarta.com" target="_blank" class="resource-link">Visit EngVarta ‚Üí</a>
                </div>

                <h3>AI Speaking Tutors</h3>
                <div class="practice-card">
                    <h4>Talkpal AI</h4>
                    <p>Natural voice conversations with instant pronunciation correction. Great for B2 level practice.</p>
                    <a href="https://talkpal.ai" target="_blank" class="resource-link">Visit Talkpal ‚Üí</a>
                </div>

                <div class="practice-card">
                    <h4>FixoLang</h4>
                    <p>IELTS-style speaking tests with cue cards and AI band score feedback.</p>
                </div>

                <div class="practice-card">
                    <h4>Speak AI</h4>
                    <p>Voice-first chat with strong pronunciation feedback for natural, relaxed speech.</p>
                </div>

                <h3>Language Exchange</h3>
                <div class="practice-card">
                    <h4>HelloTalk / Tandem</h4>
                    <p>Connect with native speakers and language learners for text, voice, and correction features.</p>
                    <a href="https://www.hellotalk.com" target="_blank" class="resource-link">Visit HelloTalk ‚Üí</a>
                </div>

                <h3>Professional Tutoring</h3>
                <div class="practice-card">
                    <h4>italki</h4>
                    <p>1-to-1 sessions with professional tutors. Structured lessons and personalized feedback.</p>
                    <a href="https://www.italki.com" target="_blank" class="resource-link">Visit italki ‚Üí</a>
                </div>

                <div class="practice-card">
                    <h4>Preply</h4>
                    <p>Business English tutors for meetings, presentations, and industry-specific topics.</p>
                    <a href="https://preply.com" target="_blank" class="resource-link">Visit Preply ‚Üí</a>
                </div>

                <h3>Free Courses</h3>
                <div class="practice-card">
                    <h4>FutureLearn - English for the Workplace</h4>
                    <p>Free MOOC with realistic workplace videos and language for jobs and offices.</p>
                    <a href="https://www.futurelearn.com/courses/workplace-english" target="_blank" class="resource-link">Visit Course ‚Üí</a>
                </div>
            </div>
        </div>
    </div>

    <!-- AI Scoring Modal -->
    <div class="modal-overlay" id="score-modal">
        <div class="modal">
            <h3>ü§ñ AI Practice Assessment</h3>
            <p class="modal-subtitle">Paste or type what you said during your practice session. Claude will score your speaking across 5 dimensions.</p>

            <div class="modal-field-label">Practice Type</div>
            <div class="topic-chips" id="score-practice-chips">
                <div class="topic-chip selected" onclick="selectChip(this)">Self-Talk</div>
                <div class="topic-chip" onclick="selectChip(this)">Topic Speaking</div>
                <div class="topic-chip" onclick="selectChip(this)">Meeting Update</div>
                <div class="topic-chip" onclick="selectChip(this)">Data Presentation</div>
                <div class="topic-chip" onclick="selectChip(this)">Role-play</div>
                <div class="topic-chip" onclick="selectChip(this)">Q&A</div>
            </div>

            <div class="modal-field-label">What you said (transcript or notes)</div>
            <textarea id="score-transcript" placeholder="Type or paste what you said during your practice. E.g: 'Today I worked on the sales dashboard... um... I found that, uh, the conversion rate dropped by 12%... from a data perspective this suggests...'"></textarea>

            <div class="modal-field-label">Duration (minutes)</div>
            <input type="number" id="score-duration" min="1" max="60" value="5"
                style="padding: 10px 14px; border: 2px solid #e2e8f0; border-radius: 8px; font-size: 0.95em; width: 100px;">

            <div id="score-result" class="score-result">
                <div id="score-loading" class="ai-loading" style="display:none;">
                    <p style="margin-bottom:14px; font-weight:600;">Analysing your practice...</p>
                    <div class="ai-loading-dots"><span></span><span></span><span></span></div>
                </div>
                <div id="score-output"></div>
            </div>

            <div class="modal-actions">
                <button class="btn" style="background:#e2e8f0; color:#333;" onclick="closeScoreModal()">Cancel</button>
                <button class="btn btn-secondary" id="score-submit-btn" onclick="submitForScoring()">‚ú® Get AI Score</button>
            </div>
        </div>
    </div>

    <script>
        let timerInterval;
        let seconds = 0;
        let practiceType = '';
        let currentTopic = '';
        let mediaRecorder;
        let audioChunks = [];
        let recordings = {};

        // Tab switching
        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tabName).classList.add('active');
        }

        // Topic selection
        function setTopic(topic) {
            currentTopic = topic;
            document.getElementById('selected-topic').style.display = 'block';
            document.getElementById('topic-name').textContent = topic;
        }

        // Practice setup
        function startPractice(type, minutes) {
            practiceType = type;
            seconds = minutes * 60;
            
            const titles = {
                'warmup': 'üåÖ Warm-up Self-Talk',
                'topic': 'üí° Topic Speaking' + (currentTopic ? ': ' + currentTopic : ''),
                'conversation': 'üí¨ Conversation Practice',
                'shadowing': 'üéØ Shadowing Practice',
                'chunking': 'üß© Chunking Practice'
            };
            
            document.getElementById('practice-title').textContent = titles[type] || 'Practice Session';
            updateTimerDisplay();
            document.getElementById('start-btn').disabled = false;
            document.getElementById('stop-btn').disabled = false;
        }

        // Timer functions
        function startTimer() {
            if (timerInterval) return;
            
            timerInterval = setInterval(() => {
                if (seconds > 0) {
                    seconds--;
                    updateTimerDisplay();
                } else {
                    stopTimer();
                    alert('Practice session complete! Great job! üéâ');
                }
            }, 1000);
            
            document.getElementById('start-btn').textContent = 'Pause';
            document.getElementById('start-btn').onclick = pauseTimer;
        }

        function pauseTimer() {
            clearInterval(timerInterval);
            timerInterval = null;
            document.getElementById('start-btn').textContent = 'Resume';
            document.getElementById('start-btn').onclick = startTimer;
        }

        function stopTimer() {
            clearInterval(timerInterval);
            timerInterval = null;
            const minutesPracticed = Math.ceil((seconds > 0 ? (practiceType === 'warmup' ? 5 : 10) * 60 - seconds : 0) / 60);
            
            // Update stats
            const totalMins = parseInt(localStorage.getItem('totalMinutes') || '0');
            localStorage.setItem('totalMinutes', totalMins + minutesPracticed);
            document.getElementById('total-minutes').textContent = totalMins + minutesPracticed;
            
            // Log practice on calendar
            if (minutesPracticed > 0) {
                logPracticeMinutes(minutesPracticed);
            }
            
            document.getElementById('start-btn').textContent = 'Start';
            document.getElementById('start-btn').onclick = startTimer;
            document.getElementById('start-btn').disabled = true;
            document.getElementById('stop-btn').disabled = true;
        }

        function resetTimer() {
            clearInterval(timerInterval);
            timerInterval = null;
            seconds = 0;
            updateTimerDisplay();
            document.getElementById('practice-title').textContent = 'Select a practice to begin';
            document.getElementById('start-btn').textContent = 'Start';
            document.getElementById('start-btn').onclick = startTimer;
            document.getElementById('start-btn').disabled = true;
            document.getElementById('stop-btn').disabled = true;
        }

        function updateTimerDisplay() {
            const mins = Math.floor(seconds / 60);
            const secs = seconds % 60;
            document.getElementById('timer').textContent = 
                String(mins).padStart(2, '0') + ':' + String(secs).padStart(2, '0');
        }

        // Recording functions
        async function toggleRecording(type) {
            const indicator = document.getElementById(type + '-recording');
            const recordBtn = document.getElementById('record-' + type + '-btn');
            
            if (indicator.classList.contains('active')) {
                // Stop recording
                if (mediaRecorder && mediaRecorder.state === 'recording') {
                    mediaRecorder.stop();
                }
                indicator.classList.remove('active');
                recordBtn.textContent = 'üéôÔ∏è Record';
            } else {
                // Start recording
                try {
                    const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                    mediaRecorder = new MediaRecorder(stream);
                    audioChunks = [];
                    
                    mediaRecorder.ondataavailable = (event) => {
                        audioChunks.push(event.data);
                    };
                    
                    mediaRecorder.onstop = () => {
                        const audioBlob = new Blob(audioChunks, { type: 'audio/webm' });
                        const audioUrl = URL.createObjectURL(audioBlob);
                        const timestamp = new Date().toLocaleString();
                        
                        // Save recording
                        if (!recordings[type]) recordings[type] = [];
                        recordings[type].push({ url: audioUrl, timestamp, blob: audioBlob });
                        
                        // Update UI
                        document.getElementById('play-' + type + '-btn').style.display = 'inline-block';
                        document.getElementById('delete-' + type + '-btn').style.display = 'inline-block';
                        displayRecordings(type);
                        
                        // Stop all tracks
                        stream.getTracks().forEach(track => track.stop());
                        
                        // Update recordings count
                        incrementStat('recordings');
                    };
                    
                    mediaRecorder.start();
                    indicator.classList.add('active');
                    recordBtn.textContent = '‚èπÔ∏è Stop Recording';
                } catch (error) {
                    alert('Could not access microphone. Please allow microphone access and try again.');
                    console.error('Error accessing microphone:', error);
                }
            }
        }

        function displayRecordings(type) {
            const container = document.getElementById(type + '-recordings-list');
            if (!container) return;
            
            const recs = recordings[type] || [];
            if (recs.length === 0) {
                container.innerHTML = '';
                return;
            }
            
            container.innerHTML = '<div style="margin-top: 15px; padding: 15px; background: #f7fafc; border-radius: 8px;">' +
                '<strong>Your Recordings:</strong>' +
                recs.map((rec, index) => `
                    <div style="padding: 10px; margin: 8px 0; background: white; border-radius: 6px; display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <div style="font-size: 0.9em; color: #666;">${rec.timestamp}</div>
                        </div>
                        <div>
                            <button class="btn" style="padding: 6px 12px; font-size: 0.9em;" onclick="playSpecificRecording('${type}', ${index})">‚ñ∂Ô∏è Play</button>
                            <button class="btn-danger btn" style="padding: 6px 12px; font-size: 0.9em;" onclick="deleteSpecificRecording('${type}', ${index})">üóëÔ∏è</button>
                        </div>
                    </div>
                `).join('') +
                '</div>';
        }

        function playRecording(type) {
            const recs = recordings[type] || [];
            if (recs.length === 0) {
                alert('No recordings available');
                return;
            }
            playSpecificRecording(type, recs.length - 1);
        }

        function playSpecificRecording(type, index) {
            const recs = recordings[type] || [];
            if (!recs[index]) return;
            
            const audio = new Audio(recs[index].url);
            audio.play();
        }

        function deleteRecording(type) {
            if (confirm('Delete all recordings for this practice?')) {
                recordings[type] = [];
                document.getElementById('play-' + type + '-btn').style.display = 'none';
                document.getElementById('delete-' + type + '-btn').style.display = 'none';
                displayRecordings(type);
            }
        }

        function deleteSpecificRecording(type, index) {
            if (confirm('Delete this recording?')) {
                recordings[type].splice(index, 1);
                if (recordings[type].length === 0) {
                    document.getElementById('play-' + type + '-btn').style.display = 'none';
                    document.getElementById('delete-' + type + '-btn').style.display = 'none';
                }
                displayRecordings(type);
            }
        }

        // Phrase practice
        function speakPhrase(element) {
            element.style.background = '#48bb78';
            element.style.color = 'white';
            setTimeout(() => {
                element.style.background = 'white';
                element.style.color = '#333';
            }, 1000);
        }

        // Progress tracking
        function incrementStat(statId) {
            const current = parseInt(document.getElementById(statId).textContent);
            const newValue = statId === 'phrases-learned' ? current + 5 : current + 1;
            document.getElementById(statId).textContent = newValue;
            localStorage.setItem(statId, newValue);
            updateProgress();
        }

        function updateProgress() {
            const checkboxes = document.querySelectorAll('input[type="checkbox"]:checked');
            const totalCheckboxes = document.querySelectorAll('input[type="checkbox"]').length;
            const percentage = Math.round((checkboxes.length / totalCheckboxes) * 100);
            
            const progressFill = document.getElementById('weekly-progress');
            progressFill.style.width = percentage + '%';
            progressFill.textContent = percentage + '%';
        }

        function savePauseCount() {
            const count = document.getElementById('pause-count').value;
            if (!count) return;
            
            const history = JSON.parse(localStorage.getItem('pauseHistory') || '[]');
            const date = new Date().toLocaleDateString();
            history.push({date, count: parseInt(count)});
            localStorage.setItem('pauseHistory', JSON.stringify(history));
            
            displayPauseHistory();
            document.getElementById('pause-count').value = '';
        }

        function displayPauseHistory() {
            const history = JSON.parse(localStorage.getItem('pauseHistory') || '[]');
            const container = document.getElementById('pause-history');
            
            if (history.length === 0) {
                container.innerHTML = '<p style="color: #999;">No recordings tracked yet</p>';
                return;
            }
            
            container.innerHTML = '<strong>History:</strong><br>' + 
                history.slice(-5).reverse().map(item => 
                    `<div style="padding: 8px; margin: 5px 0; background: #f7fafc; border-radius: 4px;">
                        ${item.date}: ${item.count} pauses
                    </div>`
                ).join('');
        }

        // Reset all progress
        function resetAllProgress() {
            console.log('Reset function called'); // Debug log
            try {
                const confirmed1 = confirm('Are you sure you want to reset ALL progress? This cannot be undone.');
                console.log('First confirmation:', confirmed1); // Debug log
                
                if (confirmed1) {
                    const confirmed2 = confirm('This will delete all stats, recordings, calendar data, and checked items. Continue?');
                    console.log('Second confirmation:', confirmed2); // Debug log
                    
                    if (confirmed2) {
                        console.log('Starting reset...'); // Debug log
                        
                        // Clear localStorage
                        localStorage.clear();
                        console.log('LocalStorage cleared'); // Debug log
                        
                        // Clear API key field
                        const keyInput = document.getElementById('api-key-input');
                        if (keyInput) keyInput.value = '';
                        
                        // Reset display
                        const daysPracticedEl = document.getElementById('days-practiced');
                        const totalMinutesEl = document.getElementById('total-minutes');
                        const recordingsEl = document.getElementById('recordings');
                        const phrasesLearnedEl = document.getElementById('phrases-learned');
                        
                        if (daysPracticedEl) daysPracticedEl.textContent = '0';
                        if (totalMinutesEl) totalMinutesEl.textContent = '0';
                        if (recordingsEl) recordingsEl.textContent = '0';
                        if (phrasesLearnedEl) phrasesLearnedEl.textContent = '0';
                        console.log('Stats reset'); // Debug log
                        
                        // Clear checkboxes
                        document.querySelectorAll('input[type="checkbox"]').forEach(cb => cb.checked = false);
                        console.log('Checkboxes cleared'); // Debug log
                        
                        // Clear recordings
                        recordings = {};
                        document.querySelectorAll('[id$="-recordings-list"]').forEach(el => el.innerHTML = '');
                        document.querySelectorAll('[id^="play-"]').forEach(btn => {
                            if (btn.id.endsWith('-btn')) btn.style.display = 'none';
                        });
                        document.querySelectorAll('[id^="delete-"]').forEach(btn => {
                            if (btn.id.endsWith('-btn') && btn.id !== 'delete-warmup-btn') btn.style.display = 'none';
                        });
                        
                        // Also hide warmup recording buttons
                        const playWarmupBtn = document.getElementById('play-warmup-btn');
                        const deleteWarmupBtn = document.getElementById('delete-warmup-btn');
                        if (playWarmupBtn) playWarmupBtn.style.display = 'none';
                        if (deleteWarmupBtn) deleteWarmupBtn.style.display = 'none';
                        console.log('Recording buttons hidden'); // Debug log
                        
                        // Clear calendar data
                        practiceData = {};
                        renderCalendar();
                        console.log('Calendar reset'); // Debug log
                        
                        // Clear pause history
                        displayPauseHistory();
                        console.log('Pause history cleared'); // Debug log
                        
                        // Reset progress bar
                        updateProgress();
                        console.log('Progress bar reset'); // Debug log
                        
                        alert('‚úÖ All progress has been reset successfully!');
                    }
                }
            } catch (error) {
                console.error('Error resetting progress:', error);
                alert('‚ùå Error resetting progress: ' + error.message + '\n\nPlease refresh the page and try again.');
            }
        }

        // Calendar functions
        let currentCalendarDate = new Date();
        let practiceData = {};

        function loadPracticeData() {
            const saved = localStorage.getItem('practiceCalendar');
            practiceData = saved ? JSON.parse(saved) : {};
        }

        function savePracticeData() {
            localStorage.setItem('practiceCalendar', JSON.stringify(practiceData));
            updateStreaks();
        }

        function getDateKey(date) {
            return date.toISOString().split('T')[0];
        }

        function markDayPracticed(dateStr, minutes = 0) {
            if (!practiceData[dateStr]) {
                practiceData[dateStr] = { minutes: 0, practiced: true };
            }
            practiceData[dateStr].minutes += minutes;
            practiceData[dateStr].practiced = true;
            savePracticeData();
            renderCalendar();
        }

        function toggleDayPractice(dateStr) {
            if (practiceData[dateStr] && practiceData[dateStr].practiced) {
                delete practiceData[dateStr];
            } else {
                practiceData[dateStr] = { practiced: true, minutes: 30 };
            }
            savePracticeData();
            renderCalendar();
        }

        function changeMonth(delta) {
            if (delta === 0) {
                currentCalendarDate = new Date();
            } else {
                currentCalendarDate.setMonth(currentCalendarDate.getMonth() + delta);
            }
            renderCalendar();
        }

        function calculateStreaks() {
            const dates = Object.keys(practiceData)
                .filter(d => practiceData[d].practiced)
                .sort()
                .reverse();
            
            if (dates.length === 0) return { current: 0, longest: 0, total: 0 };

            let currentStreak = 0;
            let longestStreak = 0;
            let tempStreak = 0;
            
            const today = getDateKey(new Date());
            const yesterday = getDateKey(new Date(Date.now() - 86400000));

            // Calculate current streak
            if (dates.includes(today) || dates.includes(yesterday)) {
                let checkDate = new Date();
                if (!dates.includes(today)) {
                    checkDate.setDate(checkDate.getDate() - 1);
                }
                
                while (dates.includes(getDateKey(checkDate))) {
                    currentStreak++;
                    checkDate.setDate(checkDate.getDate() - 1);
                }
            }

            // Calculate longest streak
            const sortedDates = dates.sort();
            for (let i = 0; i < sortedDates.length; i++) {
                if (i === 0) {
                    tempStreak = 1;
                } else {
                    const prevDate = new Date(sortedDates[i - 1]);
                    const currDate = new Date(sortedDates[i]);
                    const dayDiff = Math.floor((currDate - prevDate) / 86400000);
                    
                    if (dayDiff === 1) {
                        tempStreak++;
                    } else {
                        longestStreak = Math.max(longestStreak, tempStreak);
                        tempStreak = 1;
                    }
                }
            }
            longestStreak = Math.max(longestStreak, tempStreak);

            return {
                current: currentStreak,
                longest: longestStreak,
                total: dates.length
            };
        }

        function updateStreaks() {
            const streaks = calculateStreaks();
            document.getElementById('current-streak').textContent = streaks.current;
            document.getElementById('longest-streak').textContent = streaks.longest;
            document.getElementById('total-days').textContent = streaks.total;
        }

        function renderCalendar() {
            const year = currentCalendarDate.getFullYear();
            const month = currentCalendarDate.getMonth();
            
            // Update header
            const monthNames = ['January', 'February', 'March', 'April', 'May', 'June',
                'July', 'August', 'September', 'October', 'November', 'December'];
            document.getElementById('calendar-month-year').textContent = `${monthNames[month]} ${year}`;

            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const startingDayOfWeek = firstDay.getDay();
            const daysInMonth = lastDay.getDate();

            const grid = document.getElementById('calendar-grid');
            grid.innerHTML = '';

            // Add day labels
            const dayLabels = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
            dayLabels.forEach(label => {
                const dayLabel = document.createElement('div');
                dayLabel.className = 'calendar-day-label';
                dayLabel.textContent = label;
                grid.appendChild(dayLabel);
            });

            // Add previous month's days
            const prevMonthLastDay = new Date(year, month, 0).getDate();
            for (let i = startingDayOfWeek - 1; i >= 0; i--) {
                const day = prevMonthLastDay - i;
                const dayDiv = createCalendarDay(day, month - 1, year, true);
                grid.appendChild(dayDiv);
            }

            // Add current month's days
            const today = new Date();
            for (let day = 1; day <= daysInMonth; day++) {
                const dayDiv = createCalendarDay(day, month, year, false);
                
                const dateStr = getDateKey(new Date(year, month, day));
                const isToday = today.getDate() === day && 
                               today.getMonth() === month && 
                               today.getFullYear() === year;
                
                if (isToday) dayDiv.classList.add('today');
                
                const data = practiceData[dateStr];
                if (data && data.practiced) {
                    // Apply score-based colour intensity (1‚Äì5), fallback to base green
                    const level = data.scoreLevel || (data.practiced ? 3 : 0);
                    dayDiv.classList.add(`score-${Math.min(5, Math.max(1, level))}`);

                    if (data.score != null) {
                        const scoreSpan = document.createElement('div');
                        scoreSpan.className = 'calendar-day-minutes';
                        scoreSpan.textContent = data.score;
                        scoreSpan.title = `Score: ${data.score}/100 ¬∑ ${data.grade || ''}`;
                        dayDiv.appendChild(scoreSpan);
                    } else if (data.minutes > 0) {
                        const minutesSpan = document.createElement('div');
                        minutesSpan.className = 'calendar-day-minutes';
                        minutesSpan.textContent = `${data.minutes}m`;
                        dayDiv.appendChild(minutesSpan);
                    }
                }
                
                grid.appendChild(dayDiv);
            }

            // Add next month's days to fill the grid
            const totalCells = grid.children.length - 7; // Exclude day labels
            const remainingCells = (7 - (totalCells % 7)) % 7;
            for (let day = 1; day <= remainingCells; day++) {
                const dayDiv = createCalendarDay(day, month + 1, year, true);
                grid.appendChild(dayDiv);
            }

            updateStreaks();
        }

        function createCalendarDay(day, month, year, isOtherMonth) {
            const dayDiv = document.createElement('div');
            dayDiv.className = 'calendar-day';
            
            if (isOtherMonth) {
                dayDiv.classList.add('other-month');
            }
            
            const dayNumber = document.createElement('div');
            dayNumber.className = 'calendar-day-number';
            dayNumber.textContent = day;
            dayDiv.appendChild(dayNumber);
            
            if (!isOtherMonth) {
                dayDiv.onclick = function() {
                    const dateStr = getDateKey(new Date(year, month, day));
                    toggleDayPractice(dateStr);
                };
            }
            
            return dayDiv;
        }

        // Auto-mark today when practice is completed
        function logPracticeMinutes(minutes) {
            const today = getDateKey(new Date());
            markDayPracticed(today, minutes);
        }

        // ‚îÄ‚îÄ API Key ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        function saveApiKey(value) {
            localStorage.setItem('geminiApiKey', value);
            const status = document.getElementById('api-key-status');
            status.style.display = 'inline';
            setTimeout(() => { status.style.display = 'none'; }, 2000);
        }

        // ‚îÄ‚îÄ Score Modal ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        function openScoreModal() {
            document.getElementById('score-modal').classList.add('open');
            document.getElementById('score-result').classList.remove('visible');
            document.getElementById('score-output').innerHTML = '';
            document.getElementById('score-transcript').value = '';
            document.getElementById('score-submit-btn').disabled = false;
            document.getElementById('score-submit-btn').textContent = '‚ú® Get AI Score';
        }

        function closeScoreModal() {
            document.getElementById('score-modal').classList.remove('open');
        }

        function selectChip(el) {
            document.querySelectorAll('#score-practice-chips .topic-chip').forEach(c => c.classList.remove('selected'));
            el.classList.add('selected');
        }

        // ‚îÄ‚îÄ Call Claude API ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        async function submitForScoring() {
            const apiKey = localStorage.getItem('geminiApiKey') || '';
            if (!apiKey.startsWith('AIza')) {
                alert('Please enter your Google Gemini API key (starts with AIza) in the Track Progress tab.\n\nGet a free key at: aistudio.google.com ‚Üí "Get API key"');
                return;
            }

            const transcript = document.getElementById('score-transcript').value.trim();
            if (transcript.length < 20) {
                alert('Please enter at least a sentence or two of what you said during practice.');
                return;
            }

            const practiceType = document.querySelector('#score-practice-chips .topic-chip.selected')?.textContent || 'General';
            const duration = document.getElementById('score-duration').value || '5';

            const btn = document.getElementById('score-submit-btn');
            btn.disabled = true;
            btn.textContent = 'Analysing...';

            const resultBox = document.getElementById('score-result');
            const loading = document.getElementById('score-loading');
            resultBox.classList.add('visible');
            loading.style.display = 'block';
            document.getElementById('score-output').innerHTML = '';

            const fullPrompt = `You are an expert English speaking coach scoring a non-native English speaker's practice session.
Score their speaking sample across exactly 5 dimensions. Return ONLY valid JSON ‚Äî no markdown, no code fences, no extra text.

JSON structure:
{
  "total": <integer 0-100>,
  "grade": "<A+|A|A-|B+|B|B-|C+|C|C-|D>",
  "dimensions": {
    "fluency": { "score": <1-20>, "max": 20, "comment": "<one sentence>" },
    "vocabulary": { "score": <1-20>, "max": 20, "comment": "<one sentence>" },
    "confidence": { "score": <1-20>, "max": 20, "comment": "<one sentence>" },
    "task_completion": { "score": <1-20>, "max": 20, "comment": "<one sentence>" },
    "pronunciation": { "score": <1-20>, "max": 20, "comment": "<one sentence based on word choices/spelling cues>" }
  },
  "strengths": ["<strength 1>", "<strength 2>"],
  "improvements": ["<specific improvement 1>", "<specific improvement 2>", "<specific improvement 3>"],
  "tip": "<one actionable tip for next session>"
}

Scoring guide:
- fluency: penalise heavy filler words (um, uh, like), "..." pauses, incomplete sentences
- vocabulary: reward workplace chunks, varied words, correct technical terms
- confidence: infer from directness, hedging, sentence completeness
- task_completion: did they stay on topic and complete a coherent thought?
- pronunciation: infer from spelling patterns and any phonetic errors visible in text

Practice type: ${practiceType}
Duration: ${duration} minutes
Transcript:
"""
${transcript}
"""
Return only the JSON object, nothing else.`;

            try {
                const response = await fetch(
                    `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${apiKey}`,
                    {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            contents: [{ parts: [{ text: fullPrompt }] }],
                            generationConfig: {
                                temperature: 0.3,
                                maxOutputTokens: 800
                            }
                        })
                    }
                );

                if (!response.ok) {
                    const err = await response.json();
                    const msg = err.error?.message || `API error ${response.status}`;
                    throw new Error(msg);
                }

                const data = await response.json();
                const raw = data.candidates?.[0]?.content?.parts?.[0]?.text || '';
                const clean = raw.replace(/```json|```/g, '').trim();
                const result = JSON.parse(clean);

                loading.style.display = 'none';
                renderScoreResult(result, practiceType);

                // Save score to calendar
                const today = getDateKey(new Date());
                const scoreLevel = Math.min(5, Math.max(1, Math.ceil(result.total / 20)));
                if (!practiceData[today]) practiceData[today] = { practiced: true, minutes: parseInt(duration) };
                practiceData[today].score = result.total;
                practiceData[today].scoreLevel = scoreLevel;
                practiceData[today].grade = result.grade;
                practiceData[today].practiced = true;
                savePracticeData();
                renderCalendar();

            } catch (err) {
                loading.style.display = 'none';
                document.getElementById('score-output').innerHTML = `
                    <div style="padding:20px; color:#e53e3e; background:#fff5f5; border-radius:10px; font-size:0.95em;">
                        <strong>‚ùå Error:</strong> ${err.message}<br><br>
                        <small>‚Ä¢ Make sure your API key starts with <code>AIza</code><br>
                        ‚Ä¢ Check you have internet access<br>
                        ‚Ä¢ Get a free key at <strong>aistudio.google.com</strong></small>
                    </div>`;
                btn.disabled = false;
                btn.textContent = '‚ú® Get AI Score';
            }
        }

        function renderScoreResult(r, practiceType) {
            const dimColors = {
                fluency: '#667eea',
                vocabulary: '#764ba2',
                confidence: '#48bb78',
                task_completion: '#ed8936',
                pronunciation: '#e53e3e'
            };

            const dimLabels = {
                fluency: 'üó£Ô∏è Fluency',
                vocabulary: 'üìö Vocabulary',
                confidence: 'üí™ Confidence',
                task_completion: '‚úÖ Task Completion',
                pronunciation: 'üîä Pronunciation'
            };

            const dimsHTML = Object.entries(r.dimensions).map(([key, dim]) => `
                <div class="score-dim">
                    <div class="score-dim-name">${dimLabels[key] || key}</div>
                    <div class="score-dim-bar-wrap">
                        <div class="score-dim-bar" style="width:${(dim.score/dim.max)*100}%; background:${dimColors[key]};"></div>
                    </div>
                    <div style="display:flex; justify-content:space-between; align-items:center;">
                        <span class="score-dim-num">${dim.score}/${dim.max}</span>
                        <span style="font-size:0.78em; color:#888;">${dim.comment}</span>
                    </div>
                </div>
            `).join('');

            const strengthsHTML = (r.strengths || []).map(s => `
                <div class="feedback-item"><span class="feedback-icon">‚≠ê</span><span>${s}</span></div>
            `).join('');

            const improvementsHTML = (r.improvements || []).map(i => `
                <div class="feedback-item"><span class="feedback-icon">üí°</span><span>${i}</span></div>
            `).join('');

            document.getElementById('score-output').innerHTML = `
                <div class="score-header">
                    <div>
                        <div class="score-total">${r.total}</div>
                        <div class="score-total-label">/ 100 ¬∑ ${practiceType}</div>
                    </div>
                    <div class="score-grade">${r.grade}</div>
                </div>
                <div class="score-dimensions">${dimsHTML}</div>
                <div class="score-feedback">
                    <h4>‚≠ê Strengths</h4>
                    ${strengthsHTML}
                    <h4 style="margin-top:14px;">üí° Improvements</h4>
                    ${improvementsHTML}
                    <div style="margin-top:16px; padding:14px; background:#eef2ff; border-radius:10px; border-left:4px solid #667eea;">
                        <strong>üéØ Next session tip:</strong> ${r.tip}
                    </div>
                </div>`;

            document.getElementById('score-submit-btn').textContent = 'üîÑ Re-score';
            document.getElementById('score-submit-btn').disabled = false;
        }

        // Load saved progress on page load
        window.onload = function() {
            const daysPracticed = localStorage.getItem('days-practiced') || '0';
            const totalMinutes = localStorage.getItem('totalMinutes') || '0';
            const recordingsCount = localStorage.getItem('recordings') || '0';
            const phrasesLearned = localStorage.getItem('phrases-learned') || '0';
            
            document.getElementById('days-practiced').textContent = daysPracticed;
            document.getElementById('total-minutes').textContent = totalMinutes;
            document.getElementById('recordings').textContent = recordingsCount;
            document.getElementById('phrases-learned').textContent = phrasesLearned;
            
            displayPauseHistory();
            updateProgress();
            
            // Load API key
            const savedKey = localStorage.getItem('geminiApiKey') || '';
            const keyInput = document.getElementById('api-key-input');
            if (keyInput && savedKey) keyInput.value = savedKey;

            // Initialize calendar
            loadPracticeData();
            renderCalendar();
            
            // Attach reset button event listener
            const resetBtn = document.getElementById('reset-all-btn');
            if (resetBtn) {
                resetBtn.addEventListener('click', function() {
                    console.log('Reset button clicked via event listener');
                    resetAllProgress();
                });
                console.log('Reset button event listener attached successfully');
            } else {
                console.error('Reset button not found!');
            }
        };
    </script>
</body>
</html>